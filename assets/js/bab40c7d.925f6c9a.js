"use strict";(self.webpackChunkdocusaurus_test=self.webpackChunkdocusaurus_test||[]).push([[6199],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},E=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(t),E=r,k=u["".concat(s,".").concat(E)]||u[E]||m[E]||l;return t?a.createElement(k,o(o({ref:n},c),{},{components:t})):a.createElement(k,o({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=E;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}E.displayName="MDXCreateElement"},84227:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const l={},o=void 0,i={unversionedId:"\u4e2a\u4eba\u8d44\u6599/\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c",id:"\u4e2a\u4eba\u8d44\u6599/\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c",title:"\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c",description:"\u672c\u6587\u6700\u540e\u66f4\u65b0\u4e8e\uff1a2020\u5e7412\u670825\u65e5 \u665a\u4e0a",source:"@site/docs/\u4e2a\u4eba\u8d44\u6599/\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c.mdx",sourceDirName:"\u4e2a\u4eba\u8d44\u6599",slug:"/\u4e2a\u4eba\u8d44\u6599/\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c",permalink:"/\u4e2a\u4eba\u8d44\u6599/\u6cb9\u7334\u5ef6\u8fdf\u6267\u884c",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"\u6b63\u5219\u8868\u8fbe\u5f0f",permalink:"/\u4e2a\u4eba\u8d44\u6599/\u6b63\u5219\u8868\u8fbe\u5f0f"},next:{title:"\u8d28\u91cf\u7ba1\u7406\u4f53\u7cfb\u4e2d\u7684\u8bc4\u4ef7\u4e0e\u8bc4\u5ba1",permalink:"/\u4e2a\u4eba\u8d44\u6599/\u8d28\u91cf\u7ba1\u7406\u4f53\u7cfb\u4e2d\u7684\u8bc4\u4ef7\u4e0e\u8bc4\u5ba1"}},s={},p=[{value:"\u573a\u666f",id:"\u573a\u666f",level:2},{value:"window \u5bf9\u8c61\u4e0d\u80fd\u548c\u5916\u90e8\u4ea4\u6362\u6570\u636e",id:"window-\u5bf9\u8c61\u4e0d\u80fd\u548c\u5916\u90e8\u4ea4\u6362\u6570\u636e",level:2},{value:"Greasemonkey API \u663e\u793a undefined",id:"greasemonkey-api-\u663e\u793a-undefined",level:2},{value:"\u5185\u5b58\u7206\u70b8",id:"\u5185\u5b58\u7206\u70b8",level:2},{value:"Greasemonkey \u52a0\u8f7d\u65f6\u673a\u592a\u665a",id:"greasemonkey-\u52a0\u8f7d\u65f6\u673a\u592a\u665a",level:2},{value:"\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u8c03\u7528\uff0c\u4f8b\u5982\u7b49\u4e2a\u51e0\u79d2 Greasemonkey \u811a\u672c\u53ef\u80fd\u5c31\u52a0\u8f7d\u4e86",id:"\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u8c03\u7528\u4f8b\u5982\u7b49\u4e2a\u51e0\u79d2-greasemonkey-\u811a\u672c\u53ef\u80fd\u5c31\u52a0\u8f7d\u4e86",level:3},{value:"\u5ef6\u8fdf\u5230 Greasemonkey \u811a\u672c\u52a0\u8f7d\u5b8c\u6210\u518d\u4e0e\u4e4b\u4ea4\u4e92",id:"\u5ef6\u8fdf\u5230-greasemonkey-\u811a\u672c\u52a0\u8f7d\u5b8c\u6210\u518d\u4e0e\u4e4b\u4ea4\u4e92",level:3},{value:"\u66b4\u9732\u51fa\u9700\u8981\u4ea4\u4e92\u7684\u51fd\u6570\u7b49\u5230 Greasemonkey \u52a0\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u56de\u8c03",id:"\u66b4\u9732\u51fa\u9700\u8981\u4ea4\u4e92\u7684\u51fd\u6570\u7b49\u5230-greasemonkey-\u52a0\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u56de\u8c03",level:3}],c={toc:p},u="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u672c\u6587\u6700\u540e\u66f4\u65b0\u4e8e\uff1a2020\u5e7412\u670825\u65e5 \u665a\u4e0a"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.rxliuli.com/"},"https://blog.rxliuli.com/")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#greasemonkey-%E8%B8%A9%E5%9D%91%E4%B9%8B%E8%B7%AF"},"Greasemonkey \u8e29\u5751\u4e4b\u8def"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%9C%BA%E6%99%AF"},"\u573a\u666f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#window-%E5%AF%B9%E8%B1%A1%E4%B8%8D%E8%83%BD%E5%92%8C%E5%A4%96%E9%83%A8%E4%BA%A4%E6%8D%A2%E6%95%B0%E6%8D%AE"},"window \u5bf9\u8c61\u4e0d\u80fd\u548c\u5916\u90e8\u4ea4\u6362\u6570\u636e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#greasemonkey-api-%E6%98%BE%E7%A4%BA-undefined"},"Greasemonkey API \u663e\u793a undefined")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%86%85%E5%AD%98%E7%88%86%E7%82%B8"},"\u5185\u5b58\u7206\u70b8")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#greasemonkey-%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA%E5%A4%AA%E6%99%9A"},"Greasemonkey \u52a0\u8f7d\u65f6\u673a\u592a\u665a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E7%AD%89%E5%BE%85%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%86%8D%E8%B0%83%E7%94%A8%E4%BE%8B%E5%A6%82%E7%AD%89%E4%B8%AA%E5%87%A0%E7%A7%92-greasemonkey-%E8%84%9A%E6%9C%AC%E5%8F%AF%E8%83%BD%E5%B0%B1%E5%8A%A0%E8%BD%BD%E4%BA%86"},"\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u8c03\u7528\uff0c\u4f8b\u5982\u7b49\u4e2a\u51e0\u79d2 Greasemonkey \u811a\u672c\u53ef\u80fd\u5c31\u52a0\u8f7d\u4e86")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%BB%B6%E8%BF%9F%E5%88%B0-greasemonkey-%E8%84%9A%E6%9C%AC%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%86%8D%E4%B8%8E%E4%B9%8B%E4%BA%A4%E4%BA%92"},"\u5ef6\u8fdf\u5230 Greasemonkey \u811a\u672c\u52a0\u8f7d\u5b8c\u6210\u518d\u4e0e\u4e4b\u4ea4\u4e92")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E6%9A%B4%E9%9C%B2%E5%87%BA%E9%9C%80%E8%A6%81%E4%BA%A4%E4%BA%92%E7%9A%84%E5%87%BD%E6%95%B0%E7%AD%89%E5%88%B0-greasemonkey-%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%9B%9E%E8%B0%83"},"\u66b4\u9732\u51fa\u9700\u8981\u4ea4\u4e92\u7684\u51fd\u6570\u7b49\u5230 Greasemonkey \u52a0\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u56de\u8c03"))))))),(0,r.kt)("h2",{id:"\u573a\u666f"},(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%9C%BA%E6%99%AF"}),"\u573a\u666f",(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%9C%BA%E6%99%AF"})),(0,r.kt)("p",null,"\u6700\u8fd1\u5728\u73a9 Greasemonkey \u811a\u672c\uff0c\u9047\u5230\u4e86\u5404\u79cd\u5947\u602a\u7684\u95ee\u9898\uff0c\u4fbf\u4e8e\u6b64\u5904\u7edf\u4e00\u8bb0\u5f55\u4e00\u4e0b\u3002"),(0,r.kt)("h2",{id:"window-\u5bf9\u8c61\u4e0d\u80fd\u548c\u5916\u90e8\u4ea4\u6362\u6570\u636e"},(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#window-%E5%AF%B9%E8%B1%A1%E4%B8%8D%E8%83%BD%E5%92%8C%E5%A4%96%E9%83%A8%E4%BA%A4%E6%8D%A2%E6%95%B0%E6%8D%AE"}),"window \u5bf9\u8c61\u4e0d\u80fd\u548c\u5916\u90e8\u4ea4\u6362\u6570\u636e",(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#window-%E5%AF%B9%E8%B1%A1%E4%B8%8D%E8%83%BD%E5%92%8C%E5%A4%96%E9%83%A8%E4%BA%A4%E6%8D%A2%E6%95%B0%E6%8D%AE"})),(0,r.kt)("p",null,"\u573a\u666f"),(0,r.kt)("p",null,"\u5728\u5199 Greasemonkey \u811a\u672c\u65f6\u9047\u5230\u7684\u4e00\u4e2a\u5947\u602a\u7684\u95ee\u9898\uff0c\u543e\u8f88\u60f3\u8981\u628a\u67d0\u4e9b\u6570\u636e\u6dfb\u52a0\u5230\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window"),"\xa0\u5bf9\u8c61\u4e0a\uff0c\u65b9\u4fbf\u5728 DevTool console \u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002\u7136\u800c\u5374\u7531\u6b64\u5370\u53d1\u4e86\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff0c\u5373\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window"),"\xa0\u5bf9\u8c61\u4e0d\u662f\u771f\u6b63\u7684\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window"),"\xa0\u5bf9\u8c61\u7684\u95ee\u9898\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ==UserScript==\n// @name         Testing\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  \u7528\u6765\u6d4b\u8bd5\u7684 userjs \u811a\u672c\n// @author       rxliuli\n// @include     http://*\n// @include         https://*\n// @grant        MIT\n// ==/UserScript==\n\n;(function () {\n 'use strict'\n window.onload = function () {\n   window.rxliuli = function () {\n     console.log('\u8fd9\u91cc\u662f rxliuli \u7f16\u5199\u7684 user.js \u811a\u672c')\n   }\n   window.rxliuli()\n }\n})()\n")),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u6b63\u5e38\u8f93\u51fa\u4e86\u4e00\u53e5\u8bdd\u3002\u7136\u800c\uff0c\u5f53\u543e\u8f88\u5728 console \u4e2d\u8f93\u5165\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window.rxliuli"),"\xa0\u7684\u7ed3\u679c\u5374\u662f\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"undefined"),"\u3002"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\u89e3\u51b3"),(0,r.kt)("p",null,"\u543e\u8f88\u4f30\u8ba1\u53c8\u662f Greasemonkey \u81ea\u8eab\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u4e0d\u5f97\u4e0d\u53bb\u7ffb\u4e86\xa0",(0,r.kt)("a",{parentName:"p",href:"https://wiki.greasespot.net/"},"Wiki"),"\xa0\u4e0a\u67e5\u627e\uff0c\u76f4\u5230\u770b\u5230\u4e86\xa0",(0,r.kt)("a",{parentName:"p",href:"https://wiki.greasespot.net/Greasemonkey_Manual:Environment"},"Greasemonkey Manual:Environment"),"\u3002\u91cc\u9762\u6709\u8fd9\u4e48\u4e00\u6bb5\u8bdd"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Depending on the usage, the special Greasemonkey environment may seem perfectly normal, or excessively limiting.",(0,r.kt)("br",{parentName:"p"}),"\n","The Greasemonkey environment is a vanilla XPCNativeWrapper of the content window, with only certain extra bits added in to emulate a normal environment, or changed. Specifically:"),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"window is an XPCNativeWrapper of the content window."),(0,r.kt)("li",{parentName:"ul"},"document is the document object of the XPCNativeWrapper window object."),(0,r.kt)("li",{parentName:"ul"},"XPathResult is added so that document.evaluate() works."),(0,r.kt)("li",{parentName:"ul"},"Unless the @unwrap metadata imperative is present in the user script header, the entire script is wrapped inside an anonymous function, to guarantee the script\u2019s identifiers do not collide with identifiers present in the Mozilla JavaScript sandbox. This function wrapper captures any function definitions and var variable declarations made (e.g. var i = 5;) into the function\u2019s local scope. Declarations made without var will however end up on the script\u2019s this object, which in Greasemonkey is the global object, contrary to in the normal browser object model, where the window object fills this function. In effect, after i = 5;, the values of window","[","\u2018i\u2019","]"," and window.i remain undefined, whereas this","[","\u2018i\u2019","]"," and this.i will be 5. See also: Global object"),(0,r.kt)("li",{parentName:"ul"},"In order to access variables on the page, use the unsafeWindow object. To use values defined in a script, simply reference them by their names."))),(0,r.kt)("p",null,"\u5927\u610f\u662f Greasemonkey \u4e3a\u4e86\u5b89\u5168\u6240\u4ee5 Greasemonkey \u811a\u672c\u662f\u5728\u6c99\u7bb1\u4e2d\u6267\u884c\u7684\uff0c\u5e76\u4e14\u9650\u5236\u4e86\u4e00\u4e9b\u5185\u5bb9\u3002\u5176\u4e2d\u5c31\u5305\u62ec\u4e86\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window"),"\xa0\u5bf9\u8c61\u5e76\u975e\u6d4f\u89c8\u5668\u7684\u539f\u751f\u5bf9\u8c61\uff0c\u800c\u662f\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"XPCNativeWrapper"),"\u3002",(0,r.kt)("br",{parentName:"p"}),"\n","\u6240\u4ee5\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"XPCNativeWrapper"),"\xa0\u662f\u4ec0\u4e48\u3002\u3002\u3002\uff1f\uff08\u4e00\u4e2a Greasemonkey \u7684\u5751\u592a\u591a\u4e86\u5427 #\u5410\u8840\uff09",(0,r.kt)("br",{parentName:"p"}),"\n","\u543e\u8f88\u627e\u5230\u4e86\u4e24\u7bc7\u6587\u7ae0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-TW/docs/XPCNativeWrapper"},"XPCNat ive Wrapper")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://kb.mozillazine.org/XPCNativeWrapper"},"Use XPCNativeWrapper"))),(0,r.kt)("p",null,"\u770b\u5b8c\u4e4b\u540e\u8868\u793a\u53ea\u77e5\u9053\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"XPCNativeWrapper"),"\xa0\u662f\u5728\u6269\u5c55\u4e2d\u7528\u6765\u4fdd\u62a4\u4e0d\u53d7\u4fe1\u4efb\u7684\u5bf9\u8c61\uff0c\u5e76\u975e\u6d4f\u89c8\u5668\u5ba2\u6237\u7aef\u672c\u8eab\u7684 API\u3002"),(0,r.kt)("p",null,"\u597d\u5427\uff0c\u8bf4\u4e86\u8fd9\u4e48\u591a\u89e3\u51b3\u65b9\u6848\u662f\u4ec0\u4e48\u5462\uff1f"),(0,r.kt)("p",null,"\u7b54\u6848\u5f88\u7b80\u5355\uff0c\u5176\u5b9e\u4f7f\u7528\xa0",(0,r.kt)("a",{parentName:"p",href:"https://wiki.greasespot.net/UnsafeWindow"},"unsafeWindow"),"\xa0\u5bf9\u8c61\u5c31\u80fd\u50cf\u4f7f\u7528\u539f\u751f\u7684\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window"),"\xa0\u5bf9\u8c61\u884c\u4e3a\u4e00\u81f4\uff0c\u5373\u4fbf\u8fd9\u662f\u4e0d\u63a8\u8350\u7684\u65b9\u6cd5\uff0c\u4f46\u6709\u65f6\u4ecd\u7136\u662f\u5fc5\u987b\u7684\uff01"),(0,r.kt)("h2",{id:"greasemonkey-api-\u663e\u793a-undefined"},(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#Greasemonkey-API-%E6%98%BE%E7%A4%BA-undefined"}),"Greasemonkey API \u663e\u793a undefined",(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#Greasemonkey-API-%E6%98%BE%E7%A4%BA-undefined"})),(0,r.kt)("p",null,"\u573a\u666f"),(0,r.kt)("p",null,"\u5728\xa0",(0,r.kt)("a",{parentName:"p",href:"https://wiki.greasespot.net/Greasemonkey_Manual:API"},"Greasemonkey \u624b\u518c\uff1aAPI"),"\xa0\u5199\u51fa\u7684 API \u6709\u5f88\u591a\u90fd\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u543e\u8f88\u6253\u5370\u4e0b\u6765\u7684\u7ed3\u679c\u662f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ==UserScript==\n// @name         test\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  test\n// @match        *\n// @author       rxliuli\n// @grant        MIT\n// ==/UserScript==\n\n;(function () {\n  'use strict'\n\n  console.log(GM)\n  console.log(GM.info)\n  console.log(GM.deleteValue)\n  console.log(GM.getValue)\n  console.log(GM.listValues)\n  console.log(GM.setValue)\n  console.log(GM.getResourceUrl)\n  console.log(GM.notification)\n  console.log(GM.openInTab)\n  console.log(GM.setClipboard)\n  console.log(GM.setClipboard)\n  console.log(unsafeWindow)\n})()\n\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181219225309.png"},(0,r.kt)("img",{parentName:"a",src:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181219225309.png",alt:"Greasemonkey API \u663e\u793a undefined"}))),(0,r.kt)("p",null,"Greasemonkey API \u663e\u793a undefined"),(0,r.kt)("p",null,"\u6d4b\u8bd5\u73af\u5883\u5982\u4e0b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Windows 10 Ltsc"),(0,r.kt)("li",{parentName:"ul"},"Chrome 71"),(0,r.kt)("li",{parentName:"ul"},"tampermonkey 4.7.44")),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\u89e3\u51b3"),(0,r.kt)("p",null,"\u543e\u8f88\u5728\u7ffb\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sindresorhus/globals/issues/122"},"GitHub Issue"),"\xa0\u627e\u5230\u4e86\u95ee\u9898\u6240\u5728\uff0c\u539f\u56e0\u662f\u8fd9\u4e9b API \u5fc5\u987b\u8981\u624b\u52a8\u83b7\u53d6\u51c6\u8bb8\u624d\u884c\u3002",(0,r.kt)("br",{parentName:"p"}),"\n","\u5373\u4f7f\u7528\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"// @grant GM.[Function]"),"\xa0\u6765\u83b7\u53d6\u9700\u8981\u7684 API\uff0c\u6240\u4ee5\u543e\u8f88\u7684\u811a\u672c\u53d8\u6210\u4e86\u4e0b\u9762\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ==UserScript==\n// @name         test\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  test\n// @match        *\n// @author       rxliuli\n// @grant        MIT\n// @grant        GM.deleteValue\n// @grant        GM.getValue\n// @grant        GM.listValues\n// @grant        GM.setValue\n// @grant        GM.getResourceUrl\n// @grant        GM.notification\n// @grant        GM.openInTab\n// @grant        GM.setClipboard\n// ==/UserScript==\n\n;(function () {\n 'use strict'\n console.log(GM)\n console.log(GM.info)\n console.log(GM.deleteValue)\n console.log(GM.getValue)\n console.log(GM.listValues)\n console.log(GM.setValue)\n console.log(GM.getResourceUrl)\n console.log(GM.notification)\n console.log(GM.openInTab)\n console.log(GM.setClipboard)\n console.log(GM.setClipboard)\n console.log(unsafeWindow)\n})()\n")),(0,r.kt)("p",null,"\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u73b0\u5728\uff0c\u6240\u6709\u7684 API \u90fd\u6709\u503c\u4e86\u3002"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181219225919.png"},(0,r.kt)("img",{parentName:"a",src:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181219225919.png",alt:"GM API \u90fd\u6709\u503c\u4e86"}))),(0,r.kt)("p",null,"GM API \u90fd\u6709\u503c\u4e86"),(0,r.kt)("h2",{id:"\u5185\u5b58\u7206\u70b8"},(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%86%85%E5%AD%98%E7%88%86%E7%82%B8"}),"\u5185\u5b58\u7206\u70b8",(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%86%85%E5%AD%98%E7%88%86%E7%82%B8"})),(0,r.kt)("p",null,"\u573a\u666f"),(0,r.kt)("p",null,"\u4f7f\u7528\u4e86\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"GM.setValue()/GM.getValue()"),"\xa0\u4e24\u4e2a API\uff0c\u7ed3\u679c\u5185\u5b58\u5206\u5206\u949f\u7206\u70b8\u3002\u543e\u8f88\u5b89\u88c5 Chrome \u4ee5\u6765\u7b2c\u4e00\u6b21\u78b0\u5230\u52a0\u8f7d\u7f51\u9875\u80fd\u628a\u5185\u5b58\u8017\u5c3d\u7684\u60c5\u51b5\uff0c\u679c\u7136 GM \u7684\u9650\u5236\u4e0d\u662f\u6ca1\u6709\u9053\u7406\u7684\u5462",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181220002112.png"},(0,r.kt)("img",{parentName:"a",src:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181220002112.png",alt:"\u5185\u5b58\u7206\u70b8"}))),(0,r.kt)("p",null,"\u5185\u5b58\u7206\u70b8"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181220013001.png"},(0,r.kt)("img",{parentName:"a",src:"https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181220013001.png",alt:"\u6d4f\u89c8\u5668\u5d29\u6e83"}))),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u5d29\u6e83"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ==UserScript==\n// @name         Testing\n// @namespace    http://tampermonkey.net/\n// @match        *\n// @version      0.1\n// @description  \u7528\u6765\u6d4b\u8bd5\u7684 userjs \u811a\u672c\n// @author       rxliuli\n// @grant        GM.getValue\n// @grant        GM.setValue\n// ==/UserScript==\n\n;(function () {\n  'use strict'\n\n  var domains = {\n    domainsName: 'domains',\n    async list() {\n      var valueStr = GM.getValue(this.domainsName)\n      if (!valueStr) {\n        return null\n      }\n      try {\n        return JSON.parse(valueStr)\n      } catch (err) {\n        var defaultArr = []\n        await this.set(defaultArr)\n        return defaultArr\n      }\n    },\n    async set(arr) {\n      await GM.setValue(this.domainsName, JSON.stringify(arr))\n      return this.list()\n    },\n  }\n\n  async function init() {\n    var arr = new Array(0).fill(0).map((v, i) => i)\n    var result = await domains.set(arr)\n    console.log(result)\n  }\n\n  init()\n})()\n")),(0,r.kt)("p",null,"\u89e3\u51b3"),(0,r.kt)("p",null,"Debug \u4e4b\u540e\u53d1\u73b0\u662f\u8c03\u7528\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"GM.setValue()"),"\xa0\u6ca1\u6709\u4f7f\u7528\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"await"),"\xa0\u9020\u6210\u7684\u5f02\u6b65\u8bf7\u6c42\u6570\u91cf\u4e0d\u65ad\u79ef\u7d2f\u6700\u7ec8\u5bfc\u81f4\u7f51\u9875\u5d29\u6e83\u3002\u679c\u7136 Promise \u4ec0\u4e48\u7684\u8fd8\u662f\u8981\u5c0f\u5fc3\u4e00\u70b9\u597d\u5440",(0,r.kt)("br",{parentName:"p"}),"\n","\u5f53\u7136\uff0c\u4e0d\u4fe1\u7684\u8bdd\u4f60\u4e5f\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a Greasemonkey \u811a\u672c\u5c1d\u8bd5\u4e00\u4e0b\u5185\u5b58\u7206\u70b8\u7684\u611f\u89c9\u54af"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u9012\u5f52\u4e0d\u662f\u4e3b\u8981\u95ee\u9898\uff0c\u543e\u8f88 PC \u4e0a\u7684 Chrome \u6700\u591a\u5230 1.4w+ \u6b21\u9012\u5f52\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff08\u7f51\u9875\u6ca1\u6709\u5d29\u6e83\uff09\uff0c\u8fd8\u6ca1\u5230 1.4w+ \u6b21\uff0c\u6240\u4ee5\u8bf4\u9012\u5f52\u4e0d\u662f\u4e3b\u8981\u95ee\u9898\u5440")),(0,r.kt)("h2",{id:"greasemonkey-\u52a0\u8f7d\u65f6\u673a\u592a\u665a"},(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#Greasemonkey-%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA%E5%A4%AA%E6%99%9A"}),"Greasemonkey \u52a0\u8f7d\u65f6\u673a\u592a\u665a",(0,r.kt)("a",{parentName:"h2",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#Greasemonkey-%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA%E5%A4%AA%E6%99%9A"})),(0,r.kt)("p",null,"\u573a\u666f"),(0,r.kt)("p",null,"Greasemonkey \u7684\u52a0\u8f7d\u662f\u5728\u9875\u9762\u52a0\u8f7d\u5b8c\u6bd5\u65f6\uff0c\u7c7b\u4f3c\u4e8e\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window.onload"),"\uff0c\u6240\u4ee5\u9020\u6210\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u679c\u60f3\u8981\u5728\u7f51\u7ad9\u7684 JavaScript \u4ee3\u7801\u4e2d\u4e0e Greasemonkey \u811a\u672c\u4ea4\u4e92\uff0c\u90a3\u4e48\u5fc5\u987b\u8981\u7b49\u5230 Greasemonkey \u52a0\u8f7d\u5b8c\u6210\uff0c\u800c\u52a0\u8f7d\u5b8c\u6210\u7684\u65f6\u673a\u662f\u4e0d\u786e\u5b9a\u7684\u3002"),(0,r.kt)("p",null,"\u543e\u8f88\u76ee\u524d\u60f3\u8981\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e09\u79cd"),(0,r.kt)("h3",{id:"\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u8c03\u7528\u4f8b\u5982\u7b49\u4e2a\u51e0\u79d2-greasemonkey-\u811a\u672c\u53ef\u80fd\u5c31\u52a0\u8f7d\u4e86"},(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E7%AD%89%E5%BE%85%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%86%8D%E8%B0%83%E7%94%A8%EF%BC%8C%E4%BE%8B%E5%A6%82%E7%AD%89%E4%B8%AA%E5%87%A0%E7%A7%92-Greasemonkey-%E8%84%9A%E6%9C%AC%E5%8F%AF%E8%83%BD%E5%B0%B1%E5%8A%A0%E8%BD%BD%E4%BA%86"}),"\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u518d\u8c03\u7528\uff0c\u4f8b\u5982\u7b49\u4e2a\u51e0\u79d2 Greasemonkey \u811a\u672c\u53ef\u80fd\u5c31\u52a0\u8f7d\u4e86",(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E7%AD%89%E5%BE%85%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%86%8D%E8%B0%83%E7%94%A8%EF%BC%8C%E4%BE%8B%E5%A6%82%E7%AD%89%E4%B8%AA%E5%87%A0%E7%A7%92-Greasemonkey-%E8%84%9A%E6%9C%AC%E5%8F%AF%E8%83%BD%E5%B0%B1%E5%8A%A0%E8%BD%BD%E4%BA%86"})),(0,r.kt)("p",null,"\u601d\u8def"),(0,r.kt)("p",null,"\u73b0\u5728\u6ca1\u6709\u4eba\uff0c\u6211\u7b49\u4f1a\u518d\u6765\u95ee\u4e00\u6b21\uff01"),(0,r.kt)("p",null,"\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"    var wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms))\n")),(0,r.kt)("p",null,"\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"   // \u5b9e\u73b0\u548c\u8c03\u7528\u6700\u4e3a\u7b80\u5355\uff0c\u4f46\u65e0\u6cd5\u4fdd\u8bc1\u7b49\u5f85\u4e4b\u540e\u5c31\u4e00\u5b9a\u80fd\u83b7\u5f97\u8d44\u6e90\u4e86\n   wait(1000).then(() => console.log(\u5b8c\u6210))\n\n")),(0,r.kt)("h3",{id:"\u5ef6\u8fdf\u5230-greasemonkey-\u811a\u672c\u52a0\u8f7d\u5b8c\u6210\u518d\u4e0e\u4e4b\u4ea4\u4e92"},(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%BB%B6%E8%BF%9F%E5%88%B0-Greasemonkey-%E8%84%9A%E6%9C%AC%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%86%8D%E4%B8%8E%E4%B9%8B%E4%BA%A4%E4%BA%92"}),"\u5ef6\u8fdf\u5230 Greasemonkey \u811a\u672c\u52a0\u8f7d\u5b8c\u6210\u518d\u4e0e\u4e4b\u4ea4\u4e92",(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E5%BB%B6%E8%BF%9F%E5%88%B0-Greasemonkey-%E8%84%9A%E6%9C%AC%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%86%8D%E4%B8%8E%E4%B9%8B%E4%BA%A4%E4%BA%92"})),(0,r.kt)("p",null,"\u601d\u8def"),(0,r.kt)("p",null,"\u6709\u4eba\u5417? \u6ca1\u6709\u7684\u8bdd\u6211\u7b49\u4f1a\u518d\u6765\u95ee\uff01"),(0,r.kt)("p",null,"\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u8f6e\u8be2\u7b49\u5f85\u6307\u5b9a\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6bd5\u518d\u6267\u884c\u64cd\u4f5c\n * \u4f7f\u7528 Promises \u5b9e\u73b0\uff0c\u53ef\u4ee5\u4f7f\u7528 ES7 \u7684 {@async}/{@await} \u8c03\u7528\n * @param {Function} resourceFn \u5224\u65ad\u5fc5\u987b\u7684\u8d44\u6e90\u662f\u5426\u5b58\u5728\u7684\u65b9\u6cd5\n * @param {Object} options \u9009\u9879\n * @returns Promise \u5bf9\u8c61\n */\nfunction waitResource(resourceFn, options) {\n  var optionsRes = Object.assign(\n    {\n      interval: 1000,\n      max: 10,\n    },\n    options,\n  )\n  var current = 0\n  return new Promise((resolve, reject) => {\n    var timer = setInterval(() => {\n      if (resourceFn()) {\n        clearInterval(timer)\n        resolve()\n      }\n      current++\n      if (current >= optionsRes.max) {\n        clearInterval(timer)\n        reject('\u7b49\u5f85\u8d85\u65f6')\n      }\n    }, optionsRes.interval)\n  })\n}\n")),(0,r.kt)("p",null,"\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var resourceFn = ((i) => () => {\n  console.log(`\u7b2c ${i++} \u6b21\u8c03\u7528`)\n  return false\n})(1)\n\nwaitResource(resourceFn, {\n  interval: 1000,\n  max: 3,\n})\n  .then(() => console.log('\u5b8c\u6210'))\n  .catch((err) => console.log(err))\n\n")),(0,r.kt)("h3",{id:"\u66b4\u9732\u51fa\u9700\u8981\u4ea4\u4e92\u7684\u51fd\u6570\u7b49\u5230-greasemonkey-\u52a0\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u56de\u8c03"},(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E6%9A%B4%E9%9C%B2%E5%87%BA%E9%9C%80%E8%A6%81%E4%BA%A4%E4%BA%92%E7%9A%84%E5%87%BD%E6%95%B0%E7%AD%89%E5%88%B0-Greasemonkey-%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%9B%9E%E8%B0%83"}),"\u66b4\u9732\u51fa\u9700\u8981\u4ea4\u4e92\u7684\u51fd\u6570\u7b49\u5230 Greasemonkey \u52a0\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u56de\u8c03",(0,r.kt)("a",{parentName:"h3",href:"https://blog.rxliuli.com/p/e55a67646bf546b3900ce270a6fbc6ca/#%E6%9A%B4%E9%9C%B2%E5%87%BA%E9%9C%80%E8%A6%81%E4%BA%A4%E4%BA%92%E7%9A%84%E5%87%BD%E6%95%B0%E7%AD%89%E5%88%B0-Greasemonkey-%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%9B%9E%E8%B0%83"})),(0,r.kt)("p",null,"\u601d\u8def"),(0,r.kt)("p",null,"\u73b0\u5728\u6ca1\u6709\u4eba\uff0c\u6709\u4eba\u7684\u65f6\u5019\u518d\u53eb\u6211\uff01"),(0,r.kt)("p",null,"\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"\n/**\n * \u7b49\u5f85\u88ab\u8c03\u7528\n * @param {Number} ms \u8d85\u65f6\u6beb\u79d2\u6570\n * @param {String} name \u51c6\u5907\u88ab\u8c03\u7528\u7684\u6302\u8f7d\u5230 window \u5bf9\u8c61\u4e0a\u7684\u65b9\u6cd5\u540d\n */\nfunction waitingToCall(ms, name = 'waiting') {\n  return new Promise((resolve, reject) => {\n    var timeout = setTimeout(() => {\n      reject('\u7b49\u5f85\u8d85\u65f6')\n    }, ms)\n    window[name] = () => {\n      clearTimeout(timeout)\n      resolve()\n    }\n  })\n}\n")),(0,r.kt)("p",null,"\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"waitingToCall(3000, 'waiting')\n  .then(() => console.log('\u5b8c\u6210'))\n  .catch((err) => console.log(err))\n")))}m.isMDXComponent=!0}}]);